# 第 5 章 计算机体系结构

本章节是最难啃的"硬件"部分,我们将在 1-3 章所有芯片整合起来,合成一整台计算机,使得他可以成为能运行机器语言编写的程序.

## 背景知识

### 冯诺依曼结构

- 内存 (数据内存+指令内存)
- CPU (算数逻辑单元 ALU + 寄存器 + 控制器)
- 输入输出

### 内存

内存中有两种类型信息:**数据项** 和 **程序指令**,对这两种信息通常采用不同的处理方式,他们也被存在不同的内存区域,具有不同功能,但是这两种信息都是以二进制数据形式存储在数据结构的随机存储区域中(一种连续固定宽度的单元阵列,word 字节)每个单元都有独立的地址,

**数据内存** 高级程序操纵抽象单元,例如变量(variables),数组 array,对象 object,这些数据抽象被翻译成机器语言后,变成一连串的二进制数字,储存在计算机的数据内存中,一旦通过指定的地址,在数据内存中查询到对应内存,就可以对该 内存单元进行读写操作

**指令内存** 当高级命令被 翻译成机器语言时候,他变成一系列的二进制字,这些字代表机器指令,这些指令被存储在计算机的指令内存中,在计算机每一步,CPU 从指令中去除一个字.对其进行解码,从而执行指定的指令,然后计算下一条即将执行的指令,

### 中央处理器 CPU

CPU 是计算机体系的核心,负责执行已被加载到指令内存中的指令,这些指令高速 CPU 去执行不同的计算,对内存进行读写,以及根据条件跳转去执行程序中其他指令,CPU 中的三个主要硬件要素执行这些任务

- 算数逻辑单元 ALU Arithmetic-Logic Unit

  ALU 负责执行计算机中所有底层的算术操作和逻辑操作,比如典型的 ALU 可以执行的操作包括:

  - 将两个数字相加,
  - 检查一个数字是否为整数
  - 在一个数据字(word)中进行位操作

- 寄存器 Register

  CPU 的设计是为了更快的进行简单计算,为了提高它的计算性能,将这些和运算相关的数据暂存在某个局部存储器中是十分必要的,远比从内存中搬运要好,因此,每一个 CPU 都配有一个**高速寄存器**,每个寄存器都能够保存一个单独的字.

- 控制单元 control unit

  计算机 指令用二进制代码来表示,通常具有 16,32,64 位宽,在指令能够被执行之前,需对其进行解码,指令包括的信息向不同的硬件设备(ALU,寄存器.内存)发送信号,指使它们如何执行指令,指令的解码过程是通过某些**控制单元**来完成的,这些控制单元还负责决定下一步需要取出和执行哪一条指令/

CPU 操作现在可被描述成一个重复的循环: 从内存中取出一条指令(字):将其解码;执行该指令,取下一条指令,如此反复循环.指令的执行过程中可能包含下面一些子任务;让 ALU 计算一些值,控制内部寄存器,从存储设备中读取一个字,或向存储设备写入一个字.在执行这些任务过程中.CPU 也会计算出下一步应该读取并执行哪一条指令.

### 寄存器 Registers

内存访问是一个很慢的过程,当 CPU 被指示去内存中地址 j 的内容的时候,下面一些过程连续发生:

1. j 从 CPU 传到 RAM;
2. RAM 的直接访问逻辑(direct-access logic)选中地址为 j 的寄存器;
3. RAM[j]的内容传回给 CPU

寄存器也能提供同样的数据访问功能,但没有来回的数据传递和寻址开销.首先,寄存器位于 CPU 芯片内部,所以对他们的访问几乎可以瞬间完成;其次,与数百万个内存单元相比,寄存器数量非常少,因此,机器语言指令可以在短短几个位就能指定要操作的寄存器在什么位置,这样的指令格式更短.

基于不同的目的,不同的 CPU 采用不同的数量,不同类型的寄存器.在一些计算机体系结构中,每个寄存器可以有不同用途.

- **数据寄存器(Data registers)** 这些寄存器为 CPU 提供短期记忆(memory)服务.比如当计算(a-b)\*c 时候,必须首先计算(a-b)的值并记住它,虽然这个结果可以暂时地被存储到储存单元中,但更好的办法是在 CPU 内部即数据寄存器中.

- **寻址寄存器(Addressing registers)** 为了进行读写,CPU 必须连续访问内存中的数据,这样我们必须确定被访问的内存自(word)所在的内存地址.在某些情况下,这个地址作为当前指令的一个部分给出,而其他某些情况下它依赖于**前面一条指令的执行结果**.对于后者,这个地址应该被存储到某个寄存求中,使得该寄存器的内容在今后的操作中能够被当做储存单元的地址----这就需要用到**寻址寄存器**.

- **程序技术寄存器(Program counter registers)** 执行程序的时候,CPU 必须总是直到下一条指令在指令内存中的地址,这个地址保存在一个特殊的寄存器即**程序计数器**(PC Program Counter),PC 的内容就被当做从指令内存中取指令的地址.因此当前指令过程中,CPU 通过两种方式之一来更新 PC 的内容.
  1. 如果当前指令不包括 goto 命令,PC 增加 1 以便于指针指向程序的下一条指令;
  2. 如果当前指令中包含需要执行的 goto n 命令,则 CPU 将 PC 置为 n.

### 输入输出

当计算机使用一组输出输入(I/O)设备
